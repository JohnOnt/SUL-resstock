# bsb env: buildstock-2023.05.0
# Please check: n=100, use timestep, else monthly timeseries_frequency
schema_version: '0.3'
os_version: 3.6.1
buildstock_directory: ../ # Relative to this file or absolute
project_directory: project_national # Relative to buildstock_directory
output_directory: /projects/abctypol/largeee/test_runs/small_run_category_4_20230609/
# weather_files_url: https://data.nrel.gov/system/files/156/BuildStock_TMY3_FIPS.zip
weather_files_path: /shared-projects/buildstock/weather/BuildStock_TMY3_FIPS.zip

sampler:
  type: precomputed
  args:
    sample_file: /projects/abctypol/largeee/buildstocks/buildstock_100_20230609.csv #../buildstock_100_20230609.csv # relative to file

baseline:
  n_buildings_represented: 136569411 # American Community Survey 2019 5-year, B25001, does not include AK, HI, and territories
  skip_sims: true

eagle:
  n_jobs: 1
  minutes_per_sim: 4
  account: abctypol
  postprocessing:
    time: 20
    n_workers: 1
  sampling:
    time: 5

postprocessing:
  keep_individual_timeseries: false
  aws:
    region_name: us-west-2
    s3:
      bucket: largeee
      prefix: test_runs
    athena:
      glue_service_role: service-role/AWSGlueServiceRole-default
      database_name: largeee_test_runs
      max_crawling_time: 1200

workflow_generator:
  type: residential_hpxml
  args:
    build_existing_model:
      simulation_control_timestep: 60
      simulation_control_run_period_begin_month: 1
      simulation_control_run_period_begin_day_of_month: 1
      simulation_control_run_period_end_month: 12
      simulation_control_run_period_end_day_of_month: 31
      simulation_control_run_period_calendar_year: 2007

    emissions:
      - scenario_name: LRMER_MidCase_15
        type: CO2e
        elec_folder: data/cambium/LRMER_MidCase_15

    utility_bills:
      - scenario_name: Bills

    simulation_output_report:
      timeseries_frequency: timestep #monthly
      include_timeseries_total_consumptions: true
      include_timeseries_fuel_consumptions: true
      include_timeseries_end_use_consumptions: true
      include_timeseries_emissions: true
      include_timeseries_total_loads: false

    reporting_measures:
      - measure_dir_name: QOIReport

    server_directory_cleanup:
      retain_in_idf: false
      retain_schedules_csv: false

### -- Upgrades ---
upgrades:
  - upgrade_name: Universal Cooling
    options:
      - &add_room_ac
        option: HVAC Cooling Type|Room AC
        apply_logic:
          - and:
            - HVAC Has Ducts|No
            - HVAC Cooling Type|None
      - &add_room_ac_add_27%_partial_space_conditioning
        option: HVAC Cooling Partial Space Conditioning|27% Conditioned
        apply_logic:
          - and:
            - HVAC Has Ducts|No
            - HVAC Cooling Type|None
            - Geometry Floor Area Bin|4000+
            - or:
              - HVAC Cooling Partial Space Conditioning|<10% Conditioned
              - HVAC Cooling Partial Space Conditioning|20% Conditioned
      - &add_room_ac_add_36%_partial_space_conditioning
        option: HVAC Cooling Partial Space Conditioning|36% Conditioned
        apply_logic:
          - and:
            - HVAC Has Ducts|No
            - HVAC Cooling Type|None
            - Geometry Floor Area Bin|2500-3999
            - or:
              - HVAC Cooling Partial Space Conditioning|<10% Conditioned
              - HVAC Cooling Partial Space Conditioning|20% Conditioned
      - &add_room_ac_add_37%_partial_space_conditioning
        option: HVAC Cooling Partial Space Conditioning|37% Conditioned
        apply_logic:
          - and:
            - HVAC Has Ducts|No
            - HVAC Cooling Type|None
            - Geometry Floor Area Bin|1500-2499
            - or:
              - HVAC Cooling Partial Space Conditioning|<10% Conditioned
              - HVAC Cooling Partial Space Conditioning|20% Conditioned
      - &add_room_ac_add_52%_partial_space_conditioning
        option: HVAC Cooling Partial Space Conditioning|37% Conditioned
        apply_logic:
          - and:
            - HVAC Has Ducts|No
            - HVAC Cooling Type|None
            - Geometry Floor Area Bin|0-1499
            - or:
              - HVAC Cooling Partial Space Conditioning|<10% Conditioned
              - HVAC Cooling Partial Space Conditioning|20% Conditioned
              - HVAC Cooling Partial Space Conditioning|40% Conditioned
      - &add_central_ac
        option: HVAC Cooling Type|Central AC
        apply_logic:
          - and:
            - HVAC Has Ducts|Yes
            - HVAC Cooling Type|None
      - &add_central_ac_add_100%_partial_space_conditioning
        option: HVAC Cooling Partial Space Conditioning|100% Conditioned
        apply_logic:
          -and:
            - HVAC Has Ducts|Yes
            - HVAC Cooling Type|None
            - or:
              - HVAC Cooling Partial Space Conditioning|<10% Conditioned
              - HVAC Cooling Partial Space Conditioning|20% Conditioned
              - HVAC Cooling Partial Space Conditioning|40% Conditioned
              - HVAC Cooling Partial Space Conditioning|60% Conditioned
              - HVAC Cooling Partial Space Conditioning|80% Conditioned
      - &eff_room_ac
        option: HVAC Cooling Efficiency|Room AC, EER 12.0 #TBD
        apply_logic:
          - and:
            - HVAC Has Ducts|No
            - HVAC Cooling Type|None
      - &eff_central_ac_southeast_and_southwest
        option: HVAC Cooling Efficiency|AC, SEER 15
        apply_logic:
          - and:
            - HVAC Has Ducts|Yes
            - HVAC Cooling Type|None
            - or:
              - State|CA
              - State|NV
              - State|AZ
              - State|NM
              - State|OK
              - State|TX
              - State|AR
              - State|LA
              - State|KY
              - State|TN
              - State|MS
              - State|AL
              - State|GA
              - State|FL
              - State|SC
              - State|NC
              - State|VA
              - State|DC
              - State|MD
              - State|DE
      - &eff_central_ac_us_others
        option: HVAC Cooling Efficiency|AC, SEER 14
        apply_logic:
          - and:
            - HVAC Has Ducts|Yes
            - HVAC Cooling Type|None
            - or:
              - State|WA
              - State|OR
              - State|MT
              - State|ID
              - State|WY
              - State|UT
              - State|CO
              - State|ND
              - State|SD
              - State|NE
              - State|KS
              - State|MN
              - State|IA
              - State|MO
              - State|WI
              - State|IL
              - State|MI
              - State|IN
              - State|OH
              - State|WV
              - State|PA
              - State|NJ
              - State|NY
              - State|CT
              - State|RI
              - State|MA
              - State|VT
              - State|NH
              - State|ME

  - upgrade_name: ENERGYSTAR Room AC
    options:
      - &energystar_room_ac
        option: HVAC Cooling Efficiency|Room AC, EER 12.0
        apply_logic:
          - or:
            - HVAC Cooling Efficiency|Room AC, EER 8.5
            - HVAC Cooling Efficiency|Room AC, EER 9.8
            - HVAC Cooling Efficiency|Room AC, EER 10.7

  - upgrade_name: ENERGYSTAR Central AC
    options:
      - &energystar_central_ac
        option: HVAC Cooling Efficiency|AC, SEER 15.2
        apply_logic:
          - or:
            - HVAC Cooling Efficiency|AC, SEER 8
            - HVAC Cooling Efficiency|AC, SEER 10
            - HVAC Cooling Efficiency|AC, SEER 13
            - HVAC Cooling Efficiency|AC, SEER 15
      - &energystar_central_ac_add_100%_partial_space_conditioning
        option: HVAC Cooling Partial Space Conditioning|100% Conditioned
        apply_logic:
          -and:
            - or:
              - HVAC Cooling Efficiency|AC, SEER 8
              - HVAC Cooling Efficiency|AC, SEER 10
              - HVAC Cooling Efficiency|AC, SEER 13
              - HVAC Cooling Efficiency|AC, SEER 15
            - or:
              - HVAC Cooling Partial Space Conditioning|<10% Conditioned
              - HVAC Cooling Partial Space Conditioning|20% Conditioned
              - HVAC Cooling Partial Space Conditioning|40% Conditioned
              - HVAC Cooling Partial Space Conditioning|60% Conditioned
              - HVAC Cooling Partial Space Conditioning|80% Conditioned

  - upgrade_name: HPWH
    options:
      - &water_heater_fuel_type
        option: Water Heater Fuel|Electricity
        apply_logic:
          - not: Water Heater Fuel|Electricity
      - &water_heater_efficiency_electric_heat_pump_50_gal_3_pt_45_uef
        option: Water Heater Efficiency|Electric Heat Pump, 50 gal, 3.45 UEF
        apply_logic:
          - and:
            - not: Water Heater Efficiency|Electric Heat Pump, 50 gal, 3.45 UEF
            - or:
              - Bedrooms|1
              - Bedrooms|2
              - Bedrooms|3
      - &water_heater_efficiency_electric_heat_pump_66_gal_3_pt_35_uef
        option: Water Heater Efficiency|Electric Heat Pump, 66 gal, 3.35 UEF
        apply_logic:
          - and:
            - not: Water Heater Efficiency|Electric Heat Pump, 66 gal, 3.35 UEF
            - Bedrooms|4
      - &water_heater_efficiency_electric_heat_pump_80_gal_3_pt_45_uef
        option: Water Heater Efficiency|Electric Heat Pump, 80 gal, 3.45 UEF
        apply_logic:
          - and:
            - not: Water Heater Efficiency|Electric Heat Pump, 80 gal, 3.45 UEF
            - Bedrooms|5

  - upgrade_name: 96% AFUE Natural Gas Furnace
    options:
      - &Furnace_fuel_type
        option: HVAC Heating Type And Fuel|Natural Gas Fuel Furnace
      - &96pct_AFUE_furnace
        option: HVAC Heating Efficiency|Fuel Furnace, 96% AFUE
        apply_logic:
          - or:
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 92.5% AFUE
    package_apply_logic: 
      - and: 
        - or:
          - Heating Fuel|Natural Gas
          - Water Heater Fuel|Natural Gas
          - Clothes Dryer|Gas
          - Misc Hot Tub Spa|Natural Gas
          - Misc Pool Heater|Natural Gas
          - Misc Gas Fireplace|Gas Fireplace
          - Misc Gas Grill|Gas Grill
          - Misc Gas Lighting|Gas Lighting
        - or:
          - HVAC Heating Type And Fuel|Fuel Oil Fuel Furnace
          - HVAC Heating Type And Fuel|Propane Fuel Furnace
          - HVAC Heating Type And Fuel|Other Fuel Fuel Furnace
          - HVAC Heating Type And Fuel|Natural Gas Fuel Furnace

  - upgrade_name: 96% AFUE Natural Gas Boiler
    options:
      - &Boiler_fuel_type
        option: HVAC Heating Type And Fuel|Natural Gas Fuel Boiler
      - &96pct_AFUE_boiler
        option: HVAC Heating Efficiency|Fuel Boiler, 96% AFUE
        apply_logic:
          - or:
            - HVAC Heating Efficiency|Fuel Boiler, 76% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 80% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 90% AFUE
    package_apply_logic: 
      - and: 
        - or:
          - Heating Fuel|Natural Gas
          - Water Heater Fuel|Natural Gas
          - Clothes Dryer|Gas
          - Misc Hot Tub Spa|Natural Gas
          - Misc Pool Heater|Natural Gas
          - Misc Gas Fireplace|Gas Fireplace
          - Misc Gas Grill|Gas Grill
          - Misc Gas Lighting|Gas Lighting
        - or:
          - HVAC Heating Type And Fuel|Fuel Oil Fuel Boiler
          - HVAC Heating Type And Fuel|Propane Fuel Boiler
          - HVAC Heating Type And Fuel|Other Fuel Fuel Boiler
          - HVAC Heating Type And Fuel|Natural Gas Fuel Boiler
