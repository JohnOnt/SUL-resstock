schema_version: '0.3'
buildstock_directory: .
output_directory:
weather_files_path: /shared-projects/buildstock/weather/BuildStock_TMY3_FIPS.zip #confirm TMY3

sampler:
  type: resdiential_quota_downlselect
  args:
    n_datapoints:
    logic:
      - Vacancy Status|Occupied
      - Geometry Building Type RECS|Single-Family Detached
      - not: Vintage|1990s
      - not: Vintage|2000s
      - not: Vintage|2010s
      - or:
        - Heating Fuel|Electricity
        - Heating Fuel|Natural Gas
        - Heating Fuel|Propane
        - Heating Fuel|Fuel Oil
    resample: false

baseline:
  n_buildings_represented: 136569411 # American Community Survey 2019 5-year, B25001, does not include AK, HI, and territories

workflow_generator:
  type: residential_hpxml
  args:
    build_existing_model:
      simulation_control_run_period_calendar_year: 
      add_component_loads: false

    emissions: #same as EUSS res round 1
      - scenario_name: LRMER_MidCase_15_2025start
        type: CO2e
        elec_folder: data/cambium/LRMER_MidCase_15_2025start
        gas_value: 147.3
        propane_value: 177.8
        oil_value: 195.9
        wood_value: 200.0
      - scenario_name: LRMER_LowRECost_15_2025start
        type: CO2e
        elec_folder: data/cambium/LRMER_LowRECost_15_2025start
        gas_value: 147.3
        propane_value: 177.8
        oil_value: 195.9
        wood_value: 200.0
      - scenario_name: LRMER_95DecarbBy2035_15_2025start
        type: CO2e
        elec_folder: data/cambium/LRMER_95DecarbBy2035_15_2025start
        gas_value: 147.3
        propane_value: 177.8
        oil_value: 195.9
        wood_value: 200.0
      - scenario_name: LRMER_LowRECost_25_2025start
        type: CO2e
        elec_folder: data/cambium/LRMER_LowRECost_25_2025start
        gas_value: 147.3
        propane_value: 177.8
        oil_value: 195.9
        wood_value: 200.0

    simulation_output_report: 
      timeseries_frequency: annual #check this is right keyword

    server_directory_cleanup:
      retain_in_osm: true
      retain_in_idf: false
      retain_elpus_out_rdd: true
      retain_schedules_csv: false

    debug: false

upgrades:
  - upgrade_name: Residing
    #Up01
    options:
      - &siding_upgrade_to_fibercement
        option: Geometry Wall Exterior Finish|Fiber-Cement, Light
        apply_logic:
          and:
            - or:
              - Geometry Wall Exterior Finish|Aluminum, Light
              - Geometry Wall Exterior Finish|Fiber-Cement, Light
              - Geometry Wall Exterior Finish|Wood, Medium/Dark
        costs: &siding_costs_to_fibercement
          - value: 4.00
            multiplier: Wall Area, Above-Grade, Exterior (ft^2)
        lifetime: 30
      - &siding_upgrade_to_stucco
        option: Geometry Wall Exterior Finish|Stucco, Light
        apply_logic:
          and:
            - or:
              - Geometry Wall Exterior Finish|Brick, Light
              - Geometry Wall Exterior Finish|Brick, Medium/Dark
              - Geometry Wall Exterior Finish|Stucco, Light
              - Geometry Wall Exterior Finish|Stucco, Medium/Dark
        costs: &siding_costs_to_stucco
          - value: 5.70
            multiplier: Wall Area, Above-Grade, Exterior (ft^2)
        lifetime: 30
      - &siding_upgrade_to_vinyl
        option: Geometry Wall Exterior Finish|Vinyl, Light
        apply_logic:
          and:
            - or:
              - Geometry Wall Exterior Finish|Shingle, Asbestos, Medium
              - Geometry Wall Exterior Finish|Shingle, Composition, Medium
              - Geometry Wall Exterior Finish|Vinyl, Light
        costs: &siding_costs_to_vinyl
          - value: 3.30
            multiplier: Wall Area, Above-Grade, Exterior (ft^2)
        lifetime: 30
  # - upgrade_name: Minimum windows
  #   #Up02
  # - upgrade_name: Residing and minimum windows
  #   #Up03
  - upgrade_name: 1" polyiso exterior insulation + re-siding
    #Up04
    options:
      - &polyiso_1inch
        option: Insulation Sheathing|R-6.5
        apply_logic:
          - or: &upgradable_walls
            - Insulation Wall|Wood Stud, Uninsulated
            - Insulation Wall|Wood Stud, R-7
            - Insulation Wall|Wood Stud, R-11
            - Insulation Wall|Wood Stud, R-15
            - Insulation Wall|CMU, 6-in Hollow, Uninsulated
            - Insulation Wall|CMU, 6-in Hollow, R-7
            - Insulation Wall|CMU, 6-in Hollow, R-11
            - Insulation Wall|CMU, 6-in Hollow, R-15
            - Insulation Wall|Brick, 12-in, 3-wythe, Uninsulated
            - Insulation Wall|Brick, 12-in, 3-wythe, R-7
            - Insulation Wall|Brick, 12-in, 3-wythe, R-11
            - Insulation Wall|Brick, 12-in, 3-wythe, R-15
        costs: &polyiso_1inch_costs
          - value: 1.4
            multiplier: Wall Area, Above-Grade, Exterior (ft^2)
        lifetime: 30
      #19% ACH50 reductions are for 1" or 2" polyiso without window upgrade
      - &polyiso_infiltration_reduction
        option: Infiltration Reduction|19%
        apply_logic:
          or: *upgradable_walls
        costs: *no_cost
        lifetime: 30
      - *siding_upgrade_to_fibercement
      - *siding_upgrade_to_stucco
      - *siding_upgrade_to_vinyl
  - upgrade_name: 2" polyiso exterior insulation + re-siding
    #Up05
    options:
      - &polyiso_2inch
        option: Insulation Sheathing|R-13
        apply_logic:
          or: *upgradable_walls
        costs: &polyiso_2inch_costs
          - value: 1.9
            multiplier: Wall Area, Above-Grade, Exterior (ft^2)
        lifetime: 30
      - *polyiso_infiltration_reduction
      - *siding_upgrade_to_fibercement
      - *siding_upgrade_to_stucco
      - *siding_upgrade_to_vinyl
  - upgrade_name: Exterior low-E storm windows
    #Up06
    options:
      #low-E Storm windows
      - &low-e_storms_on_single_clear_metal
        option: Windows|Single, Clear, Metal, Exterior Low-E Storm
        apply_logic:
          - or:
              - Windows|Single, Clear, Metal
              - Windows|Single, Clear, Metal, Exterior Clear Storm
        costs: &low-e_storm_costs
          - value: 11
            multiplier: Window Area (ft^2)
        lifetime: 30
      - &low-e_storms_on_single_clear_nonmetal
        option: Windows|Single, Clear, Non-metal, Exterior Low-E Storm
        apply_logic:
          and:
            - or:
                - Windows|Single, Clear, Non-metal
                - Windows|Single, Clear, Non-metal, Exterior Clear Storm
        costs: *low-e_storm_costs
        lifetime: 30
      - &low-e_storms_on_double_clear_metal
        option: Windows|Double, Clear, Metal, Exterior Low-E Storm
        apply_logic:
          and:
            - Windows|Double, Clear, Metal, Air
        costs: *low-e_storm_costs
        lifetime: 30
      #10% ACH50 reduction for low-E storms replacing clear storms
      - &lowE_storms_replace_clear_storms_infiltration_reduction
        option: Infiltration Reduction|10%
        apply_logic:
          or: 
          - Windows|Single, Clear, Metal, Exterior Clear Storm
          - Windows|Single, Clear, Non-metal, Exterior Clear Storm
        costs: *no_cost
        lifetime: 30
      #15% ACH50 reduction for adding low-E storms where they weren't before
      - &lowE_storms_new_infiltration_reduction
        option: Infiltration Reduction|15%
        apply_logic:
          or:
            - Windows|Double, Clear, Metal, Air
            - Windows|Single, Clear, Metal
            - Windows|Single, Clear, Non-metal
        costs: *no_cost
        lifetime: 30
  - upgrade_name: Triple pane windows
    #Up07
      options:
      - &triple_window
        option: Windows|Triple, Low-E, Insulated, Argon, H-Gain
        apply_logic:
          and:
            - or:
              &upgradable_windows
                - Windows|Single, Clear, Non-metal
                - Windows|Single, Clear, Metal
                - Windows|Single, Clear, Non-metal, Exterior Clear Storm 
                - Windows|Single, Clear, Metal, Exterior Clear Storm
                - Windows|Double, Clear, Metal, Air
        costs:
          - value: 46
            multiplier: Window Area (ft^2)
        lifetime: 30
      #15% ACH50 reduction for replacing double pane with triple pane
      - &triple_replaces_double_infiltration_reduction
        option: Infiltration Reduction|15%
        apply_logic:
          - &double_pane_metal_windows
            or:
              - Windows|Double, Clear, Metal, Air
        costs: *no_cost
        lifetime: 30
      #30% ACH50 reduction for replacing single pane with triple pane
      - &triple_replaces_single_infiltration_reduction 
        option: Infiltration Reduction|30%
        apply_logic:
          - &single_pane_windows
            or:
              - Windows|Single, Clear, Non-metal
              - Windows|Single, Clear, Metal
              - Windows|Single, Clear, Non-metal, Exterior Clear Storm 
              - Windows|Single, Clear, Metal, Exterior Clear Storm
        costs: *no_cost
        lifetime: 30
  - upgrade_name: P1 Exterior low-E storm windows + 1" polyiso + re-siding
    #Up08
    options:
      - *polyiso_1inch
      - *low-e_storms_on_single_clear_metal
      - *low-e_storms_on_single_clear_nonmetal
      - *low-e_storms_on_double_clear_metal
      - &polyiso_package_infiltration_reduction
        option: Infiltration Reduction|19%
        apply_logic:
          and:
            - or: *upgradable_walls
            - not:
              - or: *upgradable_windows
        costs: *no_cost
        lifetime: 30
      - &lowE_storms_replace_clear_storms_package_infiltration_reduction
        option: Infiltration Reduction|10%
        apply_logic:
          and:
            - not:
              - or: *upgradable_walls
            - or: 
              &upgradable_clearstorm_windows
                - Windows|Single, Clear, Non-metal, Exterior Clear Storm 
                - Windows|Single, Clear, Metal, Exterior Clear Storm
        costs: *no_cost
        lifetime: 30
      - &lowE_storms_new_package_infiltration_reduction
        option: Infiltration Reduction|15%
        apply_logic:
          and:
            - not: 
              - or: *upgradable_walls
            - or:
              &upgradable_nostorm_windows
                - Windows|Single, Clear, Non-metal
                - Windows|Single, Clear, Metal
                - Windows|Double, Clear, Metal, Air
        costs: *no_cost
        lifetime: 30
      - &polyiso_and_lowE_storms_replacing_clear_storm_infiltration_reduction
        option: Infiltration Reduction|27.10%
        apply_logic: 
          and:
            - or: *upgradable_walls
            - or: *upgradable_clearstorm_windows
        costs: *no_cost
        lifetime: 30
      - &polyiso_and_lowE_storms_new_infiltration_reduction
        option: Infiltration Reduction|31.15%
        apply_logic: 
          and:
            - or: *upgradable_walls
            - or: *upgradable_nostorm_windows
        costs: *no_cost
        lifetime: 30
      - *siding_upgrade_to_fibercement
      - *siding_upgrade_to_stucco
      - *siding_upgrade_to_vinyl
  - upgrade_name: P2 Triple pane windows + 1" polyiso + re-siding
    #Up09
    options:
      - *polyiso_1inch
      - *triple_window
      - *polyiso_package_infiltration_reduction
      - &triple_replaces_single_package_infiltration_reduction
        option: Infiltration Reduction|30%
        apply_logic:
          - and:
            - not:
              - or: *upgradable_walls
            - or: *single_pane_windows
      - &triple_replaces_double_package_infiltration_reduction
        option: Infiltration Reduction|15%
        apply_logic:
          - and:
            - not:
              - or: *upgradable_walls
            - or: *double_pane_metal_windows
      - &polyiso_and_triple_replaces_single_infiltration_reduction
        option: Infiltration Reduction|43.30%
        apply_logic:
          - and:
            - or: *upgradable_walls
          - or: *single_pane_windows
      - &polyiso_and_triple_replaces_double_infiltration_reduction
        option: Infiltration Reduction|31.15%
        apply_logic:
          - and:
            - or: *upgradable_walls
          - or: *double_pane_metal_windows
      - *siding_upgrade_to_fibercement
      - *siding_upgrade_to_stucco
      - *siding_upgrade_to_vinyl
  - upgrade_name: P3 Exterior low-E storm windows + 2" polyiso + re-siding
    #Up10
    options:
      - *polyiso_2inch
      - *low-e_storms_on_single_clear_metal
      - *low-e_storms_on_single_clear_nonmetal
      - *low-e_storms_on_double_clear_metal
      - &polyiso_package_infiltration_reduction
        option: Infiltration Reduction|19%
        apply_logic:
          and:
            - or: *upgradable_walls
            - not:
              - or: *upgradable_windows
        costs: *no_cost
        lifetime: 30
      - &lowE_storms_replace_clear_storms_package_infiltration_reduction
        option: Infiltration Reduction|10%
        apply_logic:
          and:
            - not:
              - or: *upgradable_walls
            - or: 
              &upgradable_clearstorm_windows
                - Windows|Single, Clear, Non-metal, Exterior Clear Storm 
                - Windows|Single, Clear, Metal, Exterior Clear Storm
        costs: *no_cost
        lifetime: 30
      - &lowE_storms_new_package_infiltration_reduction
        option: Infiltration Reduction|15%
        apply_logic:
          and:
            - not: 
              - or: *upgradable_walls
            - or:
              &upgradable_nostorm_windows
                - Windows|Single, Clear, Non-metal
                - Windows|Single, Clear, Metal
                - Windows|Double, Clear, Metal, Air
        costs: *no_cost
        lifetime: 30
      - &polyiso_and_lowE_storms_replacing_clear_storm_infiltration_reduction
        option: Infiltration Reduction|27.10%
        apply_logic: 
          and:
            - or: *upgradable_walls
            - or: *upgradable_clearstorm_windows
        costs: *no_cost
        lifetime: 30
      - &polyiso_and_lowE_storms_new_infiltration_reduction
        option: Infiltration Reduction|31.15%
        apply_logic: 
          and:
            - or: *upgradable_walls
            - or: *upgradable_nostorm_windows
        costs: *no_cost
        lifetime: 30
      - *siding_upgrade_to_fibercement
      - *siding_upgrade_to_stucco
      - *siding_upgrade_to_vinyl
  - upgrade_name: P4 Triple pane windows + 2" polyiso + re-siding
    #Up11
    options:
      - *polyiso_2inch
      - *triple_window
      - *polyiso_package_infiltration_reduction
      - *triple_replaces_single_package_infiltration_reduction
      - *triple_replaces_double_package_infiltration_reduction
      - *polyiso_and_triple_replaces_single_infiltration_reduction
      - *polyiso_and_triple_replaces_double_infiltration_reduction
      - *siding_upgrade_to_fibercement
      - *siding_upgrade_to_stucco
      - *siding_upgrade_to_vinyl