4
d<-3
d
load("C:/Users/pb637/Documents/Yale Courses/Year 5/ENV 754/GSD/TermPaper/wrluri3.RData")
View(wsd)
# script to read in the WRLURI dta file, calculate mean regulation by CBSA and by county, and save those two outputs as dbf files
rm(list=ls()) # clear workspace i.e. remove saved variables
cat("\014") # clear console
library(haven)
library(foreign)
library(dplyr)
WRLURI<- read_dta("C:/Users/pb637/Documents/Yale Courses/Year 5/ENV 754/GSD/TermPaper/WRLURI_01_15_2020.dta")
View(WRLURI)
rm(list=ls()) # clear workspace i.e. remove saved variables
cat("\014") # clear console
setwd("~/Yale Courses/Research/Final Paper/resstock_projections/results_scripts")
# Last Update Peter Berrill May 8 2022
# Purpose: Map results of mitigation strategies and electricity scenario by county and state, for different scenarios
# Inputs: - Final_results/GHG_scen_comp_StateCty.RData, calculations of GHG emissions reductions by county and state
#         - ExtData/GHGI_maps.RData, concordance of different geographical units; county, fips codes, electrical grid regions (small and large)
#         - ExtData/GHGI_LowRECost.RData, Projections of GHG intensity of electricity, NREL Low RE Cost scenario
#         - ExtData/GHGI_MidCase.RData, Projections of GHG intensity of electricity, NREL Mid Case scenario
#         - ExtData/ctycode.RData, county names and FIPS codes
#         - Final_results/StockCountComp.RData, counts of housing stock projections by county/state from scenarios and weighted samples
# Outputs:
#         - Spatial figures for the main text (Fig 4) and supporting information, and associated csv files
library(dplyr)
library(ggplot2)
library(reshape2)
library(urbnmapr)
library(ggplot2)
library(RColorBrewer)
library(urbnthemes)
library(ggrepel)
library(stringr)
set_urbn_defaults(style = "map")
'%!in%' <- function(x,y)!('%in%'(x,y))
# load in results
load('../Final_results/GHG_scen_comp_StateCty.RData')
load('../ExtData/GHGI_maps.RData')
load('../ExtData/GHGI_LowRECost.RData')
load('../ExtData/GHGI_MidCase.RData')
# add FIPS codes
load("../ExtData/ctycode.RData")
names(ctycode)[2]<-'County'
cty_assess<-merge(cty_assess,ctycode)
# loading mapping files
counties_sf<-get_urbn_map(map = "counties", sf = TRUE)
counties_sf<-counties_sf[!counties_sf$state_abbv %in% c('AK','HI'),]
states_sf <- get_urbn_map(map = "states", sf = TRUE)
states_sf <- states_sf[!states_sf$state_abbv  %in% c('AK','HI'),]
# now map the balancing areas by county
map[map$geoid10=='46113',c('geoid10','county','RS_ID')]<-c('46102','Oglala Lakota','SD, Oglala Lakota County')
map$geoid<-map$geoid10
map[nchar(map$geoid10)==4,]$geoid<-paste('0',map[nchar(map$geoid10)==4,]$geoid10,sep="")
map$rto2<-str_sub(map$rto,4)
vars<-map
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = rto2)) + coord_sf(datum = NA)  + scale_fill_manual(values=colorRampPalette(brewer.pal(8,"Dark2"))(18))  + #scale_fill_manual(values = c("blue", "magenta",  "#fdc086", "green")) +   # scale_fill_discrete() +   # scale_fill_brewer(palette = "Set3") +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "RTO") +
ggtitle("RTO") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea20<-gicty_gea_LREC[gicty_gea_LREC$Year==2020,]
ghgi_gea20[ghgi_gea20$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea20[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_20'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_20)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("a) 2020 GHG intensity by GEA region") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea50<-gicty_gea_LREC[gicty_gea_LREC$Year==2050,]
ghgi_gea50[ghgi_gea50$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea50[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_50'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_50)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("b) 2050 GHG intensity by GEA region, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.1) +
geom_sf(map_data,mapping = aes(fill = GHG_int_50)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.1) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("b) 2050 GHG intensity by GEA region, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea20<-gicty_gea_LREC[gicty_gea_LREC$Year==2020,]
ghgi_gea20[ghgi_gea20$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea20[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_20'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.1) +
geom_sf(map_data,mapping = aes(fill = GHG_int_20)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("a) 2020 GHG intensity by GEA region") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea50<-gicty_gea_LREC[gicty_gea_LREC$Year==2050,]
ghgi_gea50[ghgi_gea50$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea50[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_50'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.1) +
geom_sf(map_data,mapping = aes(fill = GHG_int_50)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("b) 2050 GHG intensity by GEA region, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
dev.off()
417+164+789+357+991+264
