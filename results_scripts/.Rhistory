4
d<-3
d
load("C:/Users/pb637/Documents/Yale Courses/Year 5/ENV 754/GSD/TermPaper/wrluri3.RData")
View(wsd)
# script to read in the WRLURI dta file, calculate mean regulation by CBSA and by county, and save those two outputs as dbf files
rm(list=ls()) # clear workspace i.e. remove saved variables
cat("\014") # clear console
library(haven)
library(foreign)
library(dplyr)
WRLURI<- read_dta("C:/Users/pb637/Documents/Yale Courses/Year 5/ENV 754/GSD/TermPaper/WRLURI_01_15_2020.dta")
View(WRLURI)
rm(list=ls()) # clear workspace i.e. remove saved variables
cat("\014") # clear console
setwd("~/Yale Courses/Research/Final Paper/resstock_projections/results_scripts")
# Last Update Peter Berrill May 8 2022
# Purpose: Map results of mitigation strategies by county and state
# Inputs: - Final_results/GHG_scen_comp_StateCty.RData, calculations of GHG emissions reductions by county and state
#         - ExtData/GHGI_maps.RData, concordance of different geographical units; county, fips codes, electrical grid regions (small and large)
#         - ExtData/GHGI_LowRECost.RData
#         - ExtData/GHGI_MidCase.RData
#         - ExtData/ctycode.RData
#         - Final_results/StockCountComp.RData
# Outputs:
#         -
library(dplyr)
library(ggplot2)
library(reshape2)
library(urbnmapr)
library(ggplot2)
library(RColorBrewer)
library(urbnthemes)
library(ggrepel)
library(stringr)
set_urbn_defaults(style = "map")
'%!in%' <- function(x,y)!('%in%'(x,y))
# load in results
load('../Final_results/GHG_scen_comp_StateCty.RData')
load('../ExtData/GHGI_maps.RData')
load('../ExtData/GHGI_LowRECost.RData')
load('../ExtData/GHGI_MidCase.RData')
# add FIPS codes
load("../ExtData/ctycode.RData")
names(ctycode)[2]<-'County'
cty_assess<-merge(cty_assess,ctycode)
# loading mapping files
counties_sf<-get_urbn_map(map = "counties", sf = TRUE)
counties_sf<-counties_sf[!counties_sf$state_abbv %in% c('AK','HI'),]
states_sf <- get_urbn_map(map = "states", sf = TRUE)
states_sf <- states_sf[!states_sf$state_abbv  %in% c('AK','HI'),]
# Fig S33c
windows()
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_DERFA)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size = 4,color='black') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("c) Absolute reduction of Cumulative Residential GHG 2020-2060, DERFA") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
# DERFA
vars<-st_assess[,c('State','abs_redn_DERFA','pc_redn_DERFA')]
map_data<-right_join(states_sf,vars,by = c("state_abbv" ="State"))
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_DERFA)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size = 4,color='black') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("c) Absolute reduction of Cumulative Residential GHG 2020-2060, DERFA") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_DERFA)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size = 4,color='gray') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("c) Absolute reduction of Cumulative Residential GHG 2020-2060, DERFA") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
# and last LRE-ER
vars<-st_assess[,c('State','abs_redn_ER_LRE','pc_redn_ER_LRE')]
map_data<-right_join(states_sf,vars,by = c("state_abbv" ="State"))
# Fig S33f
windows()
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_ER_LRE)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size =4,color='black') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("f) Absolute reduction, Cumulative Residential GHG 2020-2060, ER & LRE") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_ER_LRE)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size =4,color='gray') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("f) Absolute reduction, Cumulative Residential GHG 2020-2060, ER & LRE") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_ER_LRE)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size =4,color='black') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("f) Absolute reduction, Cumulative Residential GHG 2020-2060, ER & LRE") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ggplot() +
geom_sf(map_data,mapping = aes(fill = abs_redn_ER_LRE)) + coord_sf(datum = NA) +
geom_sf(data = states_sf, fill = NA, color = "gray", size = 0.25) +
geom_sf_text(data = get_urbn_labels(map = "states", sf = TRUE)[-c(2,12),],aes(label = state_abbv),size =4,color='black') +
labs(fill = "Mt") + scale_fill_viridis_c(option = "viridis") +
ggtitle("f) Absolute reduction, Cumulative Residential GHG 2020-2060, ER & LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
# now map the balancing areas by county
map[map$geoid10=='46113',c('geoid10','county','RS_ID')]<-c('46102','Oglala Lakota','SD, Oglala Lakota County')
map$geoid<-map$geoid10
map[nchar(map$geoid10)==4,]$geoid<-paste('0',map[nchar(map$geoid10)==4,]$geoid10,sep="")
map$rto2<-str_sub(map$rto,4)
vars<-map
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = rto2)) + coord_sf(datum = NA)  + scale_fill_manual(values=colorRampPalette(brewer.pal(8,"Dark2"))(18))  + #scale_fill_manual(values = c("blue", "magenta",  "#fdc086", "green")) +   # scale_fill_discrete() +   # scale_fill_brewer(palette = "Set3") +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "RTO") +
ggtitle("RTO") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea20<-gicty_gea_LREC[gicty_gea_LREC$Year==2020,]
ghgi_gea20[ghgi_gea20$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea20[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_20'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_20)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("2020 GHG intensity by GEA region") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea50<-gicty_gea_LREC[gicty_gea_LREC$Year==2050,]
ghgi_gea50[ghgi_gea50$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea50[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_50'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_50)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("2050 GHG intensity by GEA region, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_50)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("b) 2050 GHG intensity by GEA region, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea20<-gicty_gea_LREC[gicty_gea_LREC$Year==2020,]
ghgi_gea20[ghgi_gea20$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea20[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_20'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_20)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("a) 2020 GHG intensity by GEA region") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea50<-gicty_gea_LREC[gicty_gea_LREC$Year==2050,]
ghgi_gea50[ghgi_gea50$geoid10==46113,]$geoid10<-46102 # fix Oglala Lakota
vars<-merge(map,ghgi_gea50[,c('geoid10','GHG_int')],by='geoid10')
names(vars)[11]<-'GHG_int_50'
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = GHG_int_50)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "gCO2/kWh") + scale_fill_viridis_c(option = "plasma") +
ggtitle("b) 2050 GHG intensity by GEA region, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
ghgi_gea20_50<-ghgi_gea50[,1:2]
ghgi_gea20_50$pc_redn_LREC<-100*(ghgi_gea20$GHG_int-ghgi_gea50$GHG_int)/ghgi_gea20$GHG_int
vars<-merge(map,ghgi_gea20_50[,c('geoid10','pc_redn_LREC')],by='geoid10')
map_data<-right_join(counties_sf,vars,by = c("county_fips" ="geoid"))
windows()
ggplot() +
geom_sf(data = counties_sf, fill = 'red', color = "#ffffff", size = 0.25) +
geom_sf(map_data,mapping = aes(fill = pc_redn_LREC)) + coord_sf(datum = NA)  +
geom_sf(data = states_sf, fill = NA, color = "#ffffff", size = 0.25) +
labs(fill = "%") + scale_fill_viridis_c(option = "plasma") +
ggtitle("2020-2050 reduction in GHG intensity, LREC") +
theme(legend.title = element_text(size = 12),legend.text = element_text(size = 12),legend.key.size = unit(2,"line"),plot.title = element_text(hjust = 0.5,size=16))
vars<-merge(vars,ghgi_gea20[,c('geoid10','GHG_int')])
names(vars)[12]<-'GHG_int_2020'
vars<-merge(vars,ghgi_gea50[,c('geoid10','GHG_int')])
names(vars)[13]<-'GHG_int_2050'
rm(list=ls()) # clear workspace i.e. remove saved variables
cat("\014") # clear console
setwd("~/Yale Courses/Research/Final Paper/resstock_projections/results_scripts")
load('../Final_results/StockCountComp.RData')
View(st40)
