schema_version: '0.3'
buildstock_directory: . # Relative to this file or absolute
project_directory: project_national  # Relative to buildstock_directory
output_directory: windows_yml_test_v3
# weather_files_url: https://s3.amazonaws.com/epwweatherfiles/project_resstock_national.zip
weather_files_url: https://data.nrel.gov/system/files/156/BuildStock_TMY3_FIPS.zip
# weather_files_path: /shared-projects/buildstock/weather/BuildStock_2018_FIPS.zip

baseline:
  n_buildings_represented: 133172057

sampler: 
  type: residential_quota
  args: 
    n_datapoints: 3

workflow_generator: 
  type: residential_hpxml
  args:
    build_existing_model:
      simulation_control_timestep: 15 # minutes
      simulation_control_run_period_begin_month: 1
      simulation_control_run_period_begin_day_of_month: 1
      simulation_control_run_period_end_month: 12
      simulation_control_run_period_end_day_of_month: 31
      simulation_control_run_period_calendar_year: 2018

    emissions: #double check syntax
      # - scenario_name: LRMER_95DecarbBy2035_15_2025start
      #   type: CO2e
      #   elec_folder: data/cambium/LRMER_95DecarbBy2035_15_2025start
      #   gas_value: 147.3
      #   propane_value: 177.8
      #   oil_value: 195.9
      #   wood_value: 200.0
      # - scenario_name: LRMER_95DecarbBy2035_25_2025start
      #   type: CO2e
      #   elec_folder: data/cambium/LRMER_95DecarbBy2035_25_2025start
      #   gas_value: 147.3
      #   propane_value: 177.8
      #   oil_value: 195.9
      #   wood_value: 200.0
      # - scenario_name: LRMER_LowRECost_15_2025start
      #   type: CO2e
      #   elec_folder: data/cambium/LRMER_LowRECost_15_2025start
      #   gas_value: 147.3
      #   propane_value: 177.8
      #   oil_value: 195.9
      #   wood_value: 200.0
      # - scenario_name: LRMER_LowRECost_25_2025start
      #   type: CO2e
      #   elec_folder: data/cambium/LRMER_LowRECost_25_2025start
      #   gas_value: 147.3
      #   propane_value: 177.8
      #   oil_value: 195.9
      #   wood_value: 200.0
      # - scenario_name: LRMER_MidCase_15_2025start
      #   type: CO2e
      #   elec_folder: data/cambium/LRMER_MidCase_15_2025start
      #   gas_value: 147.3
      #   propane_value: 177.8
      #   oil_value: 195.9
      #   wood_value: 200.0
      - scenario_name: LRMER_MidCase_25_2025start
        type: CO2e
        elec_folder: data/cambium/LRMER_MidCase_25_2025start
        gas_value: 147.3
        propane_value: 177.8
        oil_value: 195.9
        wood_value: 200.0
      - scenario_name: LRMER_95DecarbBy2050_25_2025start
        type: CO2e
        elec_folder: data/cambium/LRMER_95DecarbBy2050_25_2025start
        gas_value: 147.3
        propane_value: 177.8
        oil_value: 195.9
        wood_value: 200.0

    simulation_output_report:
      timeseries_frequency: timestep
      include_timeseries_total_consumptions: true
      include_timeseries_fuel_consumptions: true
      include_timeseries_end_use_consumptions: true
      include_timeseries_emissions: true
      include_timeseries_total_loads: true
      output_variables:
      - name: Site Outdoor Air Drybulb Temperature
      - name: Zone Mean Air Temperature
      - name: Heating Coil Heating Energy
      - name: Cooling Coil Total Cooling Energy
      - name: Cooling Coil Sensible Cooling Energy

    reporting_measures: #do we want this?
      - measure_dir_name: QOIReport

    server_directory_cleanup: #check
      debug: false

# eagle:
#   account: enduse
#   n_jobs: 600 #CHECK for full run, probably want hundreds
#   minutes_per_sim: 2
#   sampling:
#     time: 60 #CHECK for full run, probably want higher (e.g. 60)
#   postprocessing:
#     time: 240
#     n_workers: 32 #CHECK for full run, probably want like 32
#     # node_memory_mb: 751616

# postprocessing:
#   partition_columns:
#     - State
#     - County
#   aws:
#     region_name: 'us-west-2'
#     s3:
#       bucket: euss
#       prefix: full1-2018 #the folder within whatever bucket, should be specific to the run, can be in heirarchy (like GMLC/APS) in which case only the last part will be used by the athena database namer
#     athena:
#       glue_service_role: service-role/AWSGlueServiceRole-default
#       database_name: euss-full1 #collection of Athena tables (post-crawling), can be constant for the entire analysis
#       max_crawling_time: 1200 #time to wait for the crawler to complete before aborting it

upgrades:
  - upgrade_name: High-efficiency heat pumps with electric backup
    #up01
    options:
      #ducted MSHP (using a ducted MSHP rather than ASHP to achieve high efficiency)
      - &higheff_ducted_HP_all_fuel
        option: HVAC Heating Efficiency|MSHP, SEER 24, 13 HSPF # Base version, might need a "ducted" version once that change to develop is merged, behavior will not be different
        apply_logic: &ducted_higheff_HP_all_fuel_apply_logic
          - HVAC Has Ducts|Yes
          - or: &not_ASHP_greater_than_SEER_15_9_HSPF
            - not: HVAC Cooling Efficiency|Heat Pump
            - HVAC Heating Efficiency|ASHP, SEER 10, 6.2 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 13, 7.7 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 15, 8.5 HSPF
        costs: &costs_mshp_ducted_SEER_24_13_HSPF
        # Source: Using the ASHP regression because ducted MSHP costs are more similar to ASHP costs than ductless MSHP costs. 
        # Custom regression by Brennan Less. Ducted heat pump project costs were regressed on nameplate tons and HSPF,
        # from data described in in Less et al. https://doi.org/10.20357/B7FP4D. 2019$ inflated to 2022$ using 1.12 factor.
        # Ducted ASHP regression n=317. Implicitly includes electrical upgrades and electric backup.
        # The regression only had 3 datapoints > 11 HSPF (all < $15k); extrapolating to 13 HSPF leads to very high costs and may not be appropriate.
          - value: 15030.40 # for HSPF 13. Value of $9,468.70 for HSPF 11 may be a better fixed value for all highly-performance cold climate variable-speed heat pumps with HSPF 11 or higher.
            multiplier: Fixed (1)
          - value: 155.17
            multiplier: Size, Heating System Primary (kBtu/h)
        lifetime: &lifetime_mshp_ducted_SEER_24_13_HSPF 15
      - &apply_ducted_heat_pump_heating_type
        option: HVAC Heating Type|Ducted Heat Pump
        apply_logic: *ducted_higheff_HP_all_fuel_apply_logic
      # MSHP
      - &higheff_nonducted_HP_all_fuel
        option: HVAC Heating Efficiency|MSHP, SEER 29.3, 14 HSPF, Max Load # changed to Max Load
        apply_logic: &nonducted_higheff_HP_all_fuel_apply_logic
          - HVAC Has Ducts|No
          - or: &not_MSHP_greater_than_SEER_29_14_HSPF
            - not: HVAC Cooling Efficiency|Heat Pump
            - HVAC Heating Efficiency|MSHP, SEER 14.5, 8.2 HSPF
            - HVAC Heating Efficiency|MSHP, SEER 29.3, 14 HSPF
        costs: &costs_mshp_ductless_SEER_29_14_HSPF
        # Source: Custom regression by Brennan Less. Ductless heat pump project costs were regressed on nameplate tons,
        # from data described in in Less et al. https://doi.org/10.20357/B7FP4D. 2019$ inflated to 2022$ using 1.12 factor.
        # Ductless MSHP n=173, HSPF median 11, range 9.3–14.2. Implicitly includes multiple zones and electrical upgrades.
        # Regression results in costs that are 15–30% higher than costs from The Heat Pump Store as documented in https://redwoodenergy.net/wp-content/uploads/2021/02/Pocket-Guide-to-All-Electric-Retrofits-of-Single-Family-Homes.pdf 
        # LBNL data were not sufficient to include a relationship between SEER or HSPF and cost, so cost deltas for higher 
        # and lower HSPF were added using the relationship between HSPF and cost for ductless MSHPs in REMDB (https://remdb.nrel.gov/).
          - value: 2820.60
            multiplier: Fixed (1)
          - value: 367.22
            multiplier: Size, Heating System Primary (kBtu/h)
        lifetime: &lifetime_mshp_ductless_SEER_29_14_HSPF 15
      #global
      - &apply_heat_pump_cooling_efficiency
        option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *ducted_higheff_HP_all_fuel_apply_logic
            - *nonducted_higheff_HP_all_fuel_apply_logic

  - upgrade_name: triple-pane and heat pumps
    options:
      - &triple_window_h_gain
        option: Windows|Triple, Low-E, Insulated, Argon, H-Gain
        apply_logic:
          or:
            - ASHRAE IECC Climate Zone 2004|4A
            - ASHRAE IECC Climate Zone 2004|4B
            - ASHRAE IECC Climate Zone 2004|4C
            - ASHRAE IECC Climate Zone 2004|5A
            - ASHRAE IECC Climate Zone 2004|5B
            - ASHRAE IECC Climate Zone 2004|6A
            - ASHRAE IECC Climate Zone 2004|6B
            - ASHRAE IECC Climate Zone 2004|7A
            - ASHRAE IECC Climate Zone 2004|7B            
        costs:
          - value: 46
            multiplier: Window Area (ft^2)
        lifetime: 30
      #15% ACH50 reduction for replacing double with triple pane
      - &triple_window_l_gain
        option: Windows|Triple, Low-E, Insulated, Argon, L-Gain
        apply_logic:
          or:
            - ASHRAE IECC Climate Zone 2004|1A
            - ASHRAE IECC Climate Zone 2004|2A
            - ASHRAE IECC Climate Zone 2004|2B
            - ASHRAE IECC Climate Zone 2004|3A
            - ASHRAE IECC Climate Zone 2004|3B
            - ASHRAE IECC Climate Zone 2004|3C          
        costs:
          - value: 46
            multiplier: Window Area (ft^2)
        lifetime: 30
      #15% ACH50 reduction for replacing double with triple pane

  - upgrade_name: triple-pane only
    options:
      - &triple_window_h_gain
        option: Windows|Triple, Low-E, Insulated, Argon, H-Gain
        apply_logic:
          or:
            - ASHRAE IECC Climate Zone 2004|4A
            - ASHRAE IECC Climate Zone 2004|4B
            - ASHRAE IECC Climate Zone 2004|4C
            - ASHRAE IECC Climate Zone 2004|5A
            - ASHRAE IECC Climate Zone 2004|5B
            - ASHRAE IECC Climate Zone 2004|6A
            - ASHRAE IECC Climate Zone 2004|6B
            - ASHRAE IECC Climate Zone 2004|7A
            - ASHRAE IECC Climate Zone 2004|7B            
        costs:
          - value: 46
            multiplier: Window Area (ft^2)
        lifetime: 30
      #15% ACH50 reduction for replacing double with triple pane
      - &triple_window_l_gain
        option: Windows|Triple, Low-E, Insulated, Argon, L-Gain
        apply_logic:
          or:
            - ASHRAE IECC Climate Zone 2004|1A
            - ASHRAE IECC Climate Zone 2004|2A
            - ASHRAE IECC Climate Zone 2004|2B
            - ASHRAE IECC Climate Zone 2004|3A
            - ASHRAE IECC Climate Zone 2004|3B
            - ASHRAE IECC Climate Zone 2004|3C          
        costs:
          - value: 46
            multiplier: Window Area (ft^2)
        lifetime: 30
      #15% ACH50 reduction for replacing double with triple pane
      - &higheff_ducted_HP_all_fuel
        option: HVAC Heating Efficiency|MSHP, SEER 24, 13 HSPF # Base version, might need a "ducted" version once that change to develop is merged, behavior will not be different
        apply_logic: &ducted_higheff_HP_all_fuel_apply_logic
          - HVAC Has Ducts|Yes
          - or: &not_ASHP_greater_than_SEER_15_9_HSPF
            - not: HVAC Cooling Efficiency|Heat Pump
            - HVAC Heating Efficiency|ASHP, SEER 10, 6.2 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 13, 7.7 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 15, 8.5 HSPF
        costs: &costs_mshp_ducted_SEER_24_13_HSPF
        # Source: Using the ASHP regression because ducted MSHP costs are more similar to ASHP costs than ductless MSHP costs. 
        # Custom regression by Brennan Less. Ducted heat pump project costs were regressed on nameplate tons and HSPF,
        # from data described in in Less et al. https://doi.org/10.20357/B7FP4D. 2019$ inflated to 2022$ using 1.12 factor.
        # Ducted ASHP regression n=317. Implicitly includes electrical upgrades and electric backup.
        # The regression only had 3 datapoints > 11 HSPF (all < $15k); extrapolating to 13 HSPF leads to very high costs and may not be appropriate.
          - value: 15030.40 # for HSPF 13. Value of $9,468.70 for HSPF 11 may be a better fixed value for all highly-performance cold climate variable-speed heat pumps with HSPF 11 or higher.
            multiplier: Fixed (1)
          - value: 155.17
            multiplier: Size, Heating System Primary (kBtu/h)
        lifetime: &lifetime_mshp_ducted_SEER_24_13_HSPF 15
      - &apply_ducted_heat_pump_heating_type
        option: HVAC Heating Type|Ducted Heat Pump
        apply_logic: *ducted_higheff_HP_all_fuel_apply_logic
      # MSHP
      - &higheff_nonducted_HP_all_fuel
        option: HVAC Heating Efficiency|MSHP, SEER 29.3, 14 HSPF, Max Load # changed to Max Load
        apply_logic: &nonducted_higheff_HP_all_fuel_apply_logic
          - HVAC Has Ducts|No
          - or: &not_MSHP_greater_than_SEER_29_14_HSPF
            - not: HVAC Cooling Efficiency|Heat Pump
            - HVAC Heating Efficiency|MSHP, SEER 14.5, 8.2 HSPF
            - HVAC Heating Efficiency|MSHP, SEER 29.3, 14 HSPF
        costs: &costs_mshp_ductless_SEER_29_14_HSPF
        # Source: Custom regression by Brennan Less. Ductless heat pump project costs were regressed on nameplate tons,
        # from data described in in Less et al. https://doi.org/10.20357/B7FP4D. 2019$ inflated to 2022$ using 1.12 factor.
        # Ductless MSHP n=173, HSPF median 11, range 9.3–14.2. Implicitly includes multiple zones and electrical upgrades.
        # Regression results in costs that are 15–30% higher than costs from The Heat Pump Store as documented in https://redwoodenergy.net/wp-content/uploads/2021/02/Pocket-Guide-to-All-Electric-Retrofits-of-Single-Family-Homes.pdf 
        # LBNL data were not sufficient to include a relationship between SEER or HSPF and cost, so cost deltas for higher 
        # and lower HSPF were added using the relationship between HSPF and cost for ductless MSHPs in REMDB (https://remdb.nrel.gov/).
          - value: 2820.60
            multiplier: Fixed (1)
          - value: 367.22
            multiplier: Size, Heating System Primary (kBtu/h)
        lifetime: &lifetime_mshp_ductless_SEER_29_14_HSPF 15
      #global
      - &apply_heat_pump_cooling_efficiency
        option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *ducted_higheff_HP_all_fuel_apply_logic
            - *nonducted_higheff_HP_all_fuel_apply_logic