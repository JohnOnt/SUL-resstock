schema_version: '0.3'
os_version: 3.5.1
os_sha: 22e1db7be5
buildstock_directory: ../ # Relative to this file or absolute
project_directory: project_national # Relative to buildstock_directory
output_directory: /projects/abctypol/largeee/test_runs/cateory_1_20230520/
# weather_files_url: https://data.nrel.gov/system/files/156/BuildStock_TMY3_FIPS.zip
weather_files_path: /shared-projects/buildstock/weather/BuildStock_TMY3_FIPS.zip

sampler:
  type: precomputed
  args:
    sample_file: ../buildstock_10k_20230520.csv

baseline:
  n_buildings_represented: 136569411 # American Community Survey 2019 5-year, B25001, does not include AK, HI, and territories
  skip_sims: true

eagle:
  n_jobs: 3
  minutes_per_sim: 4
  account: abctypol
  postprocessing:
    time: 20
    n_workers: 1
  sampling:
    time: 5

aws:
  job_identifier: fs_1
  s3:
    bucket: largeee
    prefix: test_runs
  region: us-west-2
  use_spot: true
  batch_array_size: 10000
  notifications_email: lliu2@nrel.gov

workflow_generator:
  type: residential_hpxml
  args:
    build_existing_model:
      simulation_control_timestep: 60
      simulation_control_run_period_begin_month: 1
      simulation_control_run_period_begin_day_of_month: 1
      simulation_control_run_period_end_month: 12
      simulation_control_run_period_end_day_of_month: 31
      simulation_control_run_period_calendar_year: 2007

    emissions:
      - scenario_name: LRMER_MidCase_15
        type: CO2e
        elec_folder: data/cambium/LRMER_MidCase_15

    utility_bills:
      - scenario_name: Bills

    simulation_output_report:
      timeseries_frequency: hourly
      include_timeseries_total_consumptions: true
      include_timeseries_fuel_consumptions: true
      include_timeseries_end_use_consumptions: true
      include_timeseries_emissions: true
      include_timeseries_total_loads: false

    reporting_measures:
      - measure_dir_name: QOIReport

    server_directory_cleanup:
      retain_in_idf: false
      retain_schedules_csv: false

### -- Upgrades ---
# Federal Minimum Category
upgrades:
  - upgrade_name: Federal Minimum Heating

    options:
      # Natural Gas Boiler Federal Minimum - 90%
      - &natural_gas_boiler_fed_min
        option: HVAC Heating Efficiency|Fuel Boiler, 90% AFUE 
        apply_logic:
          - HVAC Heating Type And Fuel|Natural Gas Fuel Boiler
          - or: 
            - HVAC Heating Efficiency|Fuel Boiler, 72% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 76% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 80% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 82% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 85% AFUE

      # Fuel Oil Boiler Federal Minimum - 87%
      - &fuel_oil_boiler_fed_min
        option: HVAC Heating Efficiency|Fuel Boiler, 87% AFUE 
        apply_logic:
          - HVAC Heating Type And Fuel|Fuel Oil Fuel Boiler
          - or: 
            - HVAC Heating Efficiency|Fuel Boiler, 72% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 76% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 80% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 82% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 85% AFUE

      # Natural Gas Furnace Federal Minimum North - 95%
      - &natural_gas_furnace_fed_min_north
        option: HVAC Heating Efficiency|Fuel Furnace, 95% AFUE 
        apply_logic:
          - or: &northern_state_federal_minimum
            - State|WA
            - State|OR
            - State|MT
            - State|ID
            - State|WY
            - State|UT
            - State|CO
            - State|ND
            - State|SD
            - State|NE
            - State|KS
            - State|MN
            - State|IA
            - State|MO
            - State|WI
            - State|IL
            - State|MI
            - State|IN
            - State|OH
            - State|WV
            - State|PA
            - State|NJ
            - State|NY
            - State|CT
            - State|RI
            - State|MA
            - State|VT
            - State|NH
            - State|ME
          - HVAC Heating Type And Fuel|Natural Gas Fuel Furnace
          - or: 
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 85% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 90% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 92.5% AFUE

      # Natural Gas Furnace Federal Minimum South - 90%
      - &natural_gas_furnace_fed_min_south
        option: HVAC Heating Efficiency|Fuel Furnace, 90% AFUE 
        apply_logic:
          - or: &southern_state_federal_minimum
            - State|CA
            - State|NV
            - State|AZ
            - State|NM
            - State|OK
            - State|TX
            - State|AR
            - State|LA
            - State|KY
            - State|TN
            - State|MS
            - State|AL
            - State|GA
            - State|FL
            - State|SC
            - State|NC
            - State|VA
            - State|DC
            - State|MD
            - State|DE
          - HVAC Heating Type And Fuel|Natural Gas Fuel Furnace
          - or: 
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 85% AFUE

      # Fuel Oil Furnace Federal Minimum - 85%
      - &fuel_oil_furnace_fed_min
        option: HVAC Heating Efficiency|Fuel Furnace, 85% AFUE 
        apply_logic:
          - HVAC Heating Type And Fuel|Fuel Oil Fuel Furnace
          - or: 
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
      
      ####
      # HSPF >= 8.8 for heat pumps, this includes the constraint of SEER 14 for northern states and SEER 15 for southern states 
      # southern states
      - &heat_pump_fed_min_ducted_southern
        option: HVAC Heating Efficiency|ASHP, SEER 15, 8.8 HSPF # same as base option
        apply_logic: &fed_min_heat_pump_ASHP_ducted_southern
          - *southern_state_federal_minimum
          - HVAC Has Ducts|Yes
          - or: &not_ASHP_greater_than_8_8_HSPF
            - HVAC Heating Efficiency|ASHP, SEER 10, 6.2 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 10.3, 7.0 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 11.5, 7.5 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 13, 7.7 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 13, 8.0 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 14, 8.2 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 14.3, 8.5 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 15, 8.5 HSPF
        costs: &costs_ashp_ducted_SEER_15_9_HSPF
        # Source: Custom regression by Brennan Less. Ducted heat pump project costs were regressed on nameplate tons and HSPF,
        # from data described in in Less et al. https://doi.org/10.20357/B7FP4D. 2019$ inflated to 2022$ using 1.12 factor.
        # Ducted ASHP regression n=317. Implicitly includes electrical upgrades and electric backup.
          - value: 3907.01 # for HSPF 9
            multiplier: Fixed (1)
          - value: 155.17
            multiplier: Size, Heating System Primary (kBtu/h)
        lifetime: &lifetime_ashp_ducted_SEER_15_9_HSPF 15
      # MSHP
      - &heat_pump_fed_min_ductless_southern
        option: HVAC Heating Efficiency|MSHP, SEER 15, 8.8 HSPF
        apply_logic: &fed_min_heat_pump_MSHP_ductless_southern
          - *southern_state_federal_minimum
          - and:
            - HVAC Has Ducts|No
            - or: &not_MSHP_greater_than_8_8_HSPF
              - HVAC Heating Efficiency|MSHP, SEER 14.5, 8.2 HSPF
        costs: &costs_mshp_ductless_SEER_15_9_HSPF
        # Source: Custom regression by Brennan Less. Ductless heat pump project costs were regressed on nameplate tons,
        # from data described in in Less et al. https://doi.org/10.20357/B7FP4D. 2019$ inflated to 2022$ using 1.12 factor.
        # Ductless MSHP n=173, HSPF median 11, range 9.3–14.2. Implicitly includes multiple zones and electrical upgrades.
        # Regression results in costs that are 15–30% higher than costs from The Heat Pump Store as documented in https://redwoodenergy.net/wp-content/uploads/2021/02/Pocket-Guide-to-All-Electric-Retrofits-of-Single-Family-Homes.pdf 
        # LBNL data were not sufficient to include a relationship between SEER or HSPF and cost, so cost deltas for higher 
        # and lower HSPF were added using the relationship between HSPF and cost for ductless MSHPs in REMDB (https://remdb.nrel.gov/).
          - value: 2472.60
            multiplier: Fixed (1)
          - value: 320.42
            multiplier: Size, Heating System Primary (kBtu/h)
        lifetime: &lifetime_mshp_ductless_SEER_15_9_HSPF 
          15
      #global
      - option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *fed_min_heat_pump_ASHP_ducted_southern
            - *fed_min_heat_pump_MSHP_ductless_southern

      # northern states
      - &heat_pump_fed_min_ducted_northern
        option: HVAC Heating Efficiency|ASHP, SEER 14, 8.8 HSPF # same as base option
        apply_logic: &fed_min_heat_pump_ASHP_ducted_northern
          - *northern_state_federal_minimum
          - HVAC Has Ducts|Yes
          - or: *not_ASHP_greater_than_8_8_HSPF
        costs: *costs_ashp_ducted_SEER_15_9_HSPF
        lifetime: *lifetime_ashp_ducted_SEER_15_9_HSPF

      # MSHP
      - &heat_pump_fed_min_ductless_northern
        option: HVAC Heating Efficiency|MSHP, SEER 14, 8.8 HSPF
        apply_logic: &fed_min_heat_pump_MSHP_ductless_northern
          - *northern_state_federal_minimum
          - and:
            - HVAC Has Ducts|No
            - or: *not_MSHP_greater_than_8_8_HSPF
        costs: *costs_mshp_ductless_SEER_15_9_HSPF
        lifetime: *lifetime_mshp_ductless_SEER_15_9_HSPF 
      #global
      - option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *fed_min_heat_pump_ASHP_ducted_northern
            - *fed_min_heat_pump_MSHP_ductless_northern


  - upgrade_name: Federal Minimum Cooling
    options:
      ####
      # Federal minimum SEER 14 for northern states and SEER 15 for southern states for centrally air conditioned dwellings, split AC systems and Heat Pumps
      # CEER 11.0 for Room AC units (assuming capacity is <= 8,000 BTU/h)

      # Southern states, central AC
      - &central_AC_fed_min_southern
        option: HVAC Cooling Efficiency|AC, SEER 15
        apply_logic:
          - *southern_state_federal_minimum
          - or: 
            - HVAC Cooling Efficiency|AC, SEER 8
            - HVAC Cooling Efficiency|AC, SEER 10
            - HVAC Cooling Efficiency|AC, SEER 13
            - HVAC Cooling Efficiency|AC, SEER 14
          - HVAC Cooling Type|Central AC


      # Northern states, central AC
      - &central_AC_fed_min_northern
        option: HVAC Cooling Efficiency|AC, SEER 14
        apply_logic:
          - *northern_state_federal_minimum
          - or: 
            - HVAC Cooling Efficiency|AC, SEER 8
            - HVAC Cooling Efficiency|AC, SEER 10
            - HVAC Cooling Efficiency|AC, SEER 13
          - HVAC Cooling Type|Central AC

      # Room AC
      - &room_AC_fed_min
        option: HVAC Cooling Efficiency|Room AC, EER 11.11 # 1.01 * CEER = EER, so here 1.01 * 11 = 11.11
        apply_logic:
          - or: 
            - HVAC Cooling Efficiency|Room AC, EER 8.5
            - HVAC Cooling Efficiency|Room AC, EER 9.8
            - HVAC Cooling Efficiency|Room AC, EER 10.7
          - HVAC Cooling Type|Room AC

      # Heat Pumps
      # SEER 14 for northern states and SEER 15 for southern states, comes with HSPF == 8.8 which is the federal minimum
      # southern states
      - *heat_pump_fed_min_ducted_southern
      - *heat_pump_fed_min_ductless_southern
      - *heat_pump_fed_min_ducted_northern
      - *heat_pump_fed_min_ductless_northern
      #global
      - option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *fed_min_heat_pump_ASHP_ducted_northern
            - *fed_min_heat_pump_MSHP_ductless_northern
            - *fed_min_heat_pump_ASHP_ducted_southern
            - *fed_min_heat_pump_MSHP_ductless_southern



  - upgrade_name: Federal Minimum Heating and Cooling
    options:
    ####
    # Federal minimum heat pumps
      - *heat_pump_fed_min_ducted_southern
      - *heat_pump_fed_min_ductless_southern
      - *heat_pump_fed_min_ducted_northern
      - *heat_pump_fed_min_ductless_northern

      - option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *fed_min_heat_pump_ASHP_ducted_northern
            - *fed_min_heat_pump_MSHP_ductless_northern
            - *fed_min_heat_pump_ASHP_ducted_southern
            - *fed_min_heat_pump_MSHP_ductless_southern

    # Federal minimum AC - central and room
      - *room_AC_fed_min
      - *central_AC_fed_min_southern
      - *central_AC_fed_min_northern

    # Federal minimum boilers - NG and fuel oil
      - *natural_gas_boiler_fed_min
      - *fuel_oil_boiler_fed_min

    # Federal minimum furnaces - NG and fuel oil
      - *natural_gas_furnace_fed_min_north
      - *natural_gas_furnace_fed_min_south
      - *fuel_oil_furnace_fed_min



  - upgrade_name: Federal Minimum Water Heating
    options:
    ####
    
  - upgrade_name: Federal Minimum Heating, Cooling, and Water Heating

    options:
    ####
    # Federal minimum heat pumps
      - *heat_pump_fed_min_ducted_southern
      - *heat_pump_fed_min_ductless_southern
      - *heat_pump_fed_min_ducted_northern
      - *heat_pump_fed_min_ductless_northern

      - option: HVAC Cooling Efficiency|Heat Pump # Applied regardless of which option is applied
        apply_logic:
          or:
            - *fed_min_heat_pump_ASHP_ducted_northern
            - *fed_min_heat_pump_MSHP_ductless_northern
            - *fed_min_heat_pump_ASHP_ducted_southern
            - *fed_min_heat_pump_MSHP_ductless_southern

    # Federal minimum AC - central and room
      - *room_AC_fed_min
      - *central_AC_fed_min_southern
      - *central_AC_fed_min_northern

    # Federal minimum boilers - NG and fuel oil
      - *natural_gas_boiler_fed_min
      - *fuel_oil_boiler_fed_min

    # Federal minimum furnaces - NG and fuel oil
      - *natural_gas_furnace_fed_min_north
      - *natural_gas_furnace_fed_min_south
      - *fuel_oil_furnace_fed_min
